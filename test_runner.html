<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Test Runner</title>
</head>

<body>
    <div id="results">Running...</div>
    <script>
        // Paste the logic here to avoid dependency on external app.js which might have DOM dependencies
        function parseTextToData(text) {
            const lines = text.split('\n');
            const data = [];
            const rowRegex = /(\d+[.,]?\d*)\s*(km|m)?\s*[\t| ]+\s*(\d+[.,]?\d*)\s*(h|min|s)?/gi;

            for (const line of lines) {
                let match;
                while ((match = rowRegex.exec(line)) !== null) {
                    let distRaw = match[1].replace(',', '.');
                    let distUnit = (match[2] || 'km').toLowerCase();
                    let timeRaw = match[3].replace(',', '.');
                    let timeUnit = (match[4] || 'h').toLowerCase();
                    let distance = parseFloat(distRaw);
                    let time = parseFloat(timeRaw);

                    if (!isNaN(distance) && !isNaN(time) && time > 0) {
                        if (distUnit === 'm') distance /= 1000;
                        if (timeUnit === 'min') time /= 60;
                        else if (timeUnit === 's') time /= 3600;
                        let velocity = distance / time;
                        data.push({ distance, time, velocity });
                    }
                }
            }
            return data;
        }

        const tests = [
            { name: "Standard", input: "100 km 1 h", expected: { d: 100, t: 1, v: 100 } },
            { name: "Implicit Units", input: "100 1", expected: { d: 100, t: 1, v: 100 } },
            { name: "Meters and Minutes", input: "1000 m 30 min", expected: { d: 1, t: 0.5, v: 2 } },
            { name: "Decimals", input: "10,5 km 2,0 h", expected: { d: 10.5, t: 2, v: 5.25 } },
            { name: "Multi-column", input: "100 1 200 2", expectedCount: 2 }
        ];

        let output = "";
        let passed = 0;

        tests.forEach(test => {
            const result = parseTextToData(test.input);
            let success = false;
            if (test.expectedCount) {
                if (result.length === test.expectedCount) success = true;
                else output += `FAIL ${test.name}: Expected ${test.expectedCount}, got ${result.length}\n`;
            } else {
                if (result.length > 0) {
                    const item = result[0];
                    if (Math.abs(item.distance - test.expected.d) < 0.001 &&
                        Math.abs(item.time - test.expected.t) < 0.001 &&
                        Math.abs(item.velocity - test.expected.v) < 0.001) {
                        success = true;
                    } else {
                        output += `FAIL ${test.name}: Expected ${JSON.stringify(test.expected)}, got ${JSON.stringify(item)}\n`;
                    }
                } else {
                    output += `FAIL ${test.name}: No result\n`;
                }
            }
            if (success) passed++;
        });

        output += `Passed ${passed} / ${tests.length} tests.`;
        document.getElementById('results').innerText = output;
    </script>
</body>

</html>